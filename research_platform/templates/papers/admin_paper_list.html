{% extends 'base.html' %}
{% block title %}Manage Papers - Orravyn Admin{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        margin-bottom: 1.5rem;
    }

    .page-header h1 {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.75rem;
    }

    .search-bar {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .search-bar input {
        flex: 1;
        border: 1.5px solid rgba(0, 0, 0, 0.08);
        border-radius: 12px;
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        transition: all 0.25s ease;
    }

    .search-bar input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.08);
        outline: none;
    }

    .search-bar button {
        padding: 0.6rem 1.25rem;
        background: var(--accent-color);
        color: #fff;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.88rem;
        cursor: pointer;
        transition: all 0.25s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
    }

    .search-bar button:hover {
        background: #1d4ed8;
    }

    .admin-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .admin-table th {
        font-size: 0.72rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
        padding: 0.6rem 0.75rem;
        border-bottom: 1px solid var(--glass-border);
    }

    .admin-table td {
        font-size: 0.88rem;
        padding: 0.65rem 0.75rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        color: var(--text-primary);
        vertical-align: middle;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.15rem;
        padding: 0.12rem 0.5rem;
        border-radius: 50px;
        font-size: 0.68rem;
        font-weight: 600;
    }

    .status-badge.approved {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .status-badge.pending {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
    }

    .table-act {
        font-size: 0.78rem;
        font-weight: 600;
        text-decoration: none;
        margin-right: 0.5rem;
        transition: all 0.2s ease;
    }

    .table-act.view {
        color: var(--accent-color);
    }

    .table-act.view:hover {
        color: #1d4ed8;
    }

    .table-act.delete {
        color: #dc2626;
    }

    .table-act.delete:hover {
        color: #b91c1c;
    }

    .empty-row td {
        text-align: center;
        color: var(--text-secondary);
        padding: 2rem;
    }

    .pager {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1.5rem;
    }

    .pager a,
    .pager span {
        padding: 0.4rem 0.85rem;
        border-radius: 8px;
        font-size: 0.82rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .pager a {
        color: var(--accent-color);
        border: 1px solid rgba(37, 99, 235, 0.15);
    }

    .pager a:hover {
        background: rgba(37, 99, 235, 0.06);
    }

    .pager span {
        background: var(--accent-color);
        color: #fff;
        border: 1px solid var(--accent-color);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Paper Management</h1>
</div>

<form method="get" class="search-bar">
    <input type="text" name="search" placeholder="Search by title, abstract, authors..." value="{{ search_query }}">
    <button type="submit"><i class="fas fa-search"></i> Search</button>
</form>

<div style="overflow-x: auto;">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Authors</th>
                <th>Uploaded By</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for paper in papers %}
            <tr>
                <td>{{ paper.title|truncatechars:40 }}</td>
                <td>{{ paper.authors|truncatechars:25 }}</td>
                <td>{{ paper.uploaded_by.username }}</td>
                <td>
                    {% if paper.is_approved %}
                    <span class="status-badge approved"><i class="fas fa-check-circle"></i> Approved</span>
                    {% else %}
                    <span class="status-badge pending"><i class="fas fa-clock"></i> Pending</span>
                    {% endif %}
                </td>
                <td>{{ paper.created_at|date:"Y-m-d" }}</td>
                <td>
                    <a href="{% url 'papers:detail' paper.pk %}" class="table-act view"><i class="fas fa-eye"></i>
                        View</a>
                    <a href="{% url 'papers:delete' paper.pk %}" class="table-act delete"
                        onclick="return confirmAction(event, 'Are you sure you want to delete this paper?')"><i
                            class="fas fa-trash"></i> Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr class="empty-row">
                <td colspan="6">No papers found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div class="pager">
    {% if page_obj.has_previous %}<a href="?search={{ search_query }}&page={{ page_obj.previous_page_number }}">←
        Previous</a>{% endif %}
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}<a href="?search={{ search_query }}&page={{ page_obj.next_page_number }}">Next →</a>{% endif %}
</div>
{% endif %}
{% endblock %}